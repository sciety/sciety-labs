{% from 'macros/atom.xml' import render_atom_authors_for_article_meta -%}

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title type="html">Search feed for {{ query }}</title>
    <link href="{{ request.url }}" rel="self" />
    <updated>{{ last_updated_timestamp | timestamp_isoformat }}</updated>
    <id>tag:sciety-labs,2023-04-20:search-parameters-hash={{ search_parameters_hash }}</id>

    {%- for item in search_results %}
    <entry>
        <title type="html">{{ item.article_meta.article_title }}</title>
        <link href="https://sciety.org/articles/activity/{{ item.article_doi }}?utm_source=sciety_labs_atom_feed" />
        <published>{{ item.article_meta.published_date | date_isoformat }}T00:00:00+00:00</published>
        <updated>{{ item.article_meta.published_date | date_isoformat }}T00:00:00+00:00</updated>
        <id>tag:sciety-labs,2023-04-20:doi={{ item.article_doi }}</id>

        {%- if item.article_meta.abstract %}
        <content type="xhtml">
            <div xmlns="http://www.w3.org/1999/xhtml">
                {%- if item.comment %}
                <figure class="comment">
                    <blockquote><p>{{ item.comment.text }}</p></blockquote>
                    <figcaption>â€”{{ item.comment.author.name }}</figcaption>
                </figure>
                {%- endif %}
                <div class="article-abstract">
                    <h2>Abstract</h2>
                    <div>
                        {{ item.article_meta.abstract | sanitize }}
                    </div>
                </div>
            </div>
        </content>
        {%- endif %}

        {{- render_atom_authors_for_article_meta(item.article_meta) }}
    </entry>
    {% endfor %}
</feed>